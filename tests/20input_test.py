import sys
import os
import pytest

sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))

from project import law_analyzer


# لیست ۲۰ جمله نمونه (ورودی)
inputs = [
    "دسترسی غیرمجاز به داده‌ها و سامانه‌ها جرم است",
    "شنود غیرمجاز ارتباطات رایانه‌ای ممنوع است",
    "نشر اکاذیب در فضای مجازی مجازات دارد",
    "هک کردن سیستم‌های کامپیوتری پیگرد قانونی دارد",
    "دسترسی به اطلاعات محرمانه کامپیوتری جرم است",
    "تخریب داده‌های رایانه‌ای جرم شناخته می‌شود",
    "ارسال هرزنامه به سیستم‌های رایانه‌ای ممنوع است",
    "کلاهبرداری اینترنتی پیگرد قانونی دارد",
    "دسترسی غیرمجاز به اطلاعات شخصی جرم است",
    "نشر ویروس کامپیوتری جرم است",
    "جعل در فضای مجازی مجازات دارد",
    "دسترسی به سامانه‌های مخابراتی بدون اجازه جرم است",
    "انتشار محتوای غیرمجاز جرم است",
    "حملات سایبری جرم محسوب می‌شود",
    "دسترسی غیرمجاز به سامانه‌های رایانه‌ای جرم است",
    "شنود ارتباطات غیرعمومی ممنوع است",
    "نشر اکاذیب در فضای مجازی جرم دارد",
    "خرابکاری در سامانه‌های رایانه‌ای جرم است",
    "دسترسی غیرمجاز به داده‌ها جرم است",
    "کلاهبرداری رایانه‌ای جرم شناخته می‌شود"
]

# خروجی مورد انتظار (نام ماده قانون، به عنوان شناسه تشخیص)
expected_articles = [
    "ماده 1 قانون جرایم رایانه‌ای",
    "ماده 2 قانون جرایم رایانه‌ای",
    "ماده 3 قانون جرایم رایانه‌ای",
    "ماده 4 قانون جرایم رایانه‌ای",
    "ماده 5 قانون جرایم رایانه‌ای",
    "ماده 6 قانون جرایم رایانه‌ای",
    "ماده 7 قانون جرایم رایانه‌ای",
    "ماده 8 قانون جرایم رایانه‌ای",
    "ماده 9 قانون جرایم رایانه‌ای",
    "ماده 10 قانون جرایم رایانه‌ای",
    "ماده 11 قانون جرایم رایانه‌ای",
    "ماده 12 قانون جرایم رایانه‌ای",
    "ماده 13 قانون جرایم رایانه‌ای",
    "ماده 14 قانون جرایم رایانه‌ای",
    "ماده 15 قانون جرایم رایانه‌ای",
    "ماده 16 قانون جرایم رایانه‌ای",
    "ماده 17 قانون جرایم رایانه‌ای",
    "ماده 18 قانون جرایم رایانه‌ای",
    "ماده 19 قانون جرایم رایانه‌ای",
    "ماده 20 قانون جرایم رایانه‌ای"
]

@pytest.mark.parametrize("input_text,expected_article", zip(inputs, expected_articles))
def test_law_analyzer(input_text, expected_article):
    analysis = law_analyzer.analyze_text(input_text)
    matched_article = analysis["matched"]["article"]
    assert matched_article == expected_article

def test_accuracy():
    correct = 0
    total = len(inputs)
    for input_text, expected_article in zip(inputs, expected_articles):
        analysis = law_analyzer.analyze_text(input_text)
        if analysis["matched"]["article"] == expected_article:
            correct += 1
    accuracy = correct / total * 100
    print(f"\nدقت تشخیص: {accuracy:.2f}%")
    assert accuracy > 0  # می‌تونی شرط دقیق‌تری بذاری
